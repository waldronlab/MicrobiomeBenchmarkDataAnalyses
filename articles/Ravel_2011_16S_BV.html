<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ravel_2011_16S_BV - Bacterial vaginosis • MicrobiomeBenchmarkDataAnalyses</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Ravel_2011_16S_BV - Bacterial vaginosis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MicrobiomeBenchmarkDataAnalyses</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/MicrobiomeBenchmarkDataAnalyses.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/HMP_2012_16S_gingival_V13.html"> HMP_2012_16S_gingival_V13 - subgingival vs supgragingival plaque</a>
    </li>
    <li>
      <a href="../articles/HMP_2012_16S_gingival_V35_subset.html">HMP_2012_16S_gingival_V35_subset - subgingival vs supragingival</a>
    </li>
    <li>
      <a href="../articles/HMP_2012_16S_gingival_V35.html"> HMP_2012_16S_gingival_V35 - subgingival vs supgragingival plaque</a>
    </li>
    <li>
      <a href="../articles/HMP_2012_WMS_gingival.html">HMP_2012_WMS_gingiva - Supragingival vs subgingival plaque</a>
    </li>
    <li>
      <a href="../articles/Ravel_2011_16S_BV.html">Ravel_2011_16S_BV - Bacterial vaginosis</a>
    </li>
    <li>
      <a href="../articles/Stammler_2016_16S_spikein.html">Sammler_2016_16S_spikein - Spike-in bacteria</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waldronlab/MicrobiomeBenchmarkDataAnalyses/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ravel_2011_16S_BV - Bacterial vaginosis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waldronlab/MicrobiomeBenchmarkDataAnalyses/blob/main/vignettes/articles/Ravel_2011_16S_BV.Rmd" class="external-link"><code>vignettes/articles/Ravel_2011_16S_BV.Rmd</code></a></small>
      <div class="hidden name"><code>Ravel_2011_16S_BV.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/waldronlab/MicrobiomeBenchmarkDataAnalyses" class="external-link">MicrobiomeBenchmarkDataAnalyses</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/waldronlab/MicrobiomeBenchmarkData" class="external-link">MicrobiomeBenchmarkData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/microbiome/mia" class="external-link">mia</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dx.plos.org/10.1371/journal.pone.0061217" class="external-link">phyloseq</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">benchdamic</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stemangiola/tidySummarizedExperiment" class="external-link">tidySummarizedExperiment</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, several differential abundance (DA) methods will be
compared using the <em>Ravel_2011_16S_BV</em> dataset. Lactobacillus is
expected to be enriched in healthy vagina (HV) samples and other taxa,
such as Gardnerella and Prevotella, are expected to be more abundant or
enriched in bacterial vaginosis (BV) samples.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<div class="section level3">
<h3 id="import-summarize-by-genus-and-filter">Import, summarize by genus, and filter<a class="anchor" aria-label="anchor" href="#import-summarize-by-genus-and-filter"></a>
</h3>
<ul>
<li>Select equal number of samples per ethnicity group. This was based
on the minimum number of samples in an ethnicity.</li>
<li>Summarize (agglomerate) by genus.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_name</span> <span class="op">&lt;-</span> <span class="st">'Ravel_2011_16S_BV'</span></span>
<span><span class="va">conditions_col</span> <span class="op">&lt;-</span> <span class="st">'study_condition'</span></span>
<span><span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>condB <span class="op">=</span> <span class="st">'healthy'</span>, condA <span class="op">=</span> <span class="st">'bacterial_vaginosis'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://waldronlab.io/MicrobiomeBenchmarkData/reference/getBenchmarkData.html" class="external-link">getBenchmarkData</a></span><span class="op">(</span><span class="va">dat_name</span>, dryrun <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Select equal number of samples per ethnicity group</span></span>
<span><span class="va">col_data</span> <span class="op">&lt;-</span> <span class="va">tse</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">study_condition</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">conditions</span><span class="op">)</span></span>
<span><span class="va">row_names_list</span> <span class="op">&lt;-</span> <span class="va">col_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">ethnicity</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">y</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.x</span><span class="op">$</span><span class="va">study_condition</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span>recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">rownames</span><span class="op">)</span></span>
<span><span class="va">min_n</span> <span class="op">&lt;-</span> <span class="va">row_names_list</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_int</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4567</span><span class="op">)</span></span>
<span><span class="va">select_samples</span> <span class="op">&lt;-</span> <span class="va">row_names_list</span> <span class="op">|&gt;</span></span>
<span>    <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">y</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">min_n</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span>use.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">tse_subset</span> <span class="op">&lt;-</span> <span class="va">tse</span><span class="op">[</span>, <span class="va">select_samples</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Summarize by genus</span></span>
<span><span class="va">tse_genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/agglomerate-methods.html" class="external-link">agglomerateByRank</a></span><span class="op">(</span></span>
<span>    <span class="va">tse_subset</span>, rank <span class="op">=</span> <span class="st">'genus'</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span>, onRankOnly <span class="op">=</span> <span class="cn">TRUE</span> </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Filter low abundance/presence taxa</span></span>
<span><span class="va">tse_genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterTaxa.html">filterTaxa</a></span><span class="op">(</span><span class="va">tse_genus</span>, min_ab <span class="op">=</span> <span class="fl">1</span>, min_per <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">tse_genus</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/editMiaTaxaNames.html">editMiaTaxaNames</a></span><span class="op">(</span><span class="va">tse_genus</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Set study conditions in the right order for analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">tse_genus</span><span class="op">)</span><span class="op">$</span><span class="va">study_condition</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">tse_genus</span><span class="op">)</span><span class="op">$</span><span class="va">study_condition</span>, levels <span class="op">=</span> <span class="va">conditions</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tse_genus</span></span></code></pre></div>
<pre><code><span><span class="co">## class: TreeSummarizedExperiment </span></span>
<span><span class="co">## dim: 26 80 </span></span>
<span><span class="co">## metadata(1): agglomerated_by_rank</span></span>
<span><span class="co">## assays(1): counts</span></span>
<span><span class="co">## rownames(26): genus:Lactobacillus genus:Prevotella ...</span></span>
<span><span class="co">##   genus:Anaeroglobus genus:Bulleidia</span></span>
<span><span class="co">## rowData names(7): kingdom class ... species taxon_annotation</span></span>
<span><span class="co">## colnames(80): S250 S383 ... S325 S276</span></span>
<span><span class="co">## colData names(17): dataset gender ... nugent_score_category</span></span>
<span><span class="co">##   community_group</span></span>
<span><span class="co">## reducedDimNames(0):</span></span>
<span><span class="co">## mainExpName: NULL</span></span>
<span><span class="co">## altExpNames(0):</span></span>
<span><span class="co">## rowLinks: NULL</span></span>
<span><span class="co">## rowTree: NULL</span></span>
<span><span class="co">## colLinks: NULL</span></span>
<span><span class="co">## colTree: NULL</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="get-prior-info">Get prior info<a class="anchor" aria-label="anchor" href="#get-prior-info"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior_info</span> <span class="op">&lt;-</span> <span class="va">tse_genus</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">genus</span>, <span class="va">taxon_annotation</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>taxon_name <span class="op">=</span> <span class="va">genus</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        taxon_annotation <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">taxon_annotation</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Unannotated"</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">taxon_annotation</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="convert-to-phyloseq">Convert to phyloseq<a class="anchor" aria-label="anchor" href="#convert-to-phyloseq"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/makePhyloseqFromTreeSE.html" class="external-link">makePhyloseqFromTreeSummarizedExperiment</a></span><span class="op">(</span><span class="va">tse_genus</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html" class="external-link">sample_data</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span><span class="op">[[</span><span class="va">conditions_col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html" class="external-link">sample_data</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span><span class="op">[[</span><span class="va">conditions_col</span><span class="op">]</span><span class="op">]</span>, levels <span class="op">=</span> <span class="va">conditions</span><span class="op">)</span></span>
<span><span class="va">ps</span></span></code></pre></div>
<pre><code><span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 26 taxa and 80 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 80 samples by 17 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 26 taxa by 6 taxonomic ranks ]</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="benchdamic-workflow">Benchdamic workflow<a class="anchor" aria-label="anchor" href="#benchdamic-workflow"></a>
</h2>
<div class="section level3">
<h3 id="set-da-methods">Set DA methods<a class="anchor" aria-label="anchor" href="#set-da-methods"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Normalization methods supported in benchdamic</span></span>
<span><span class="va">norm_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_norm_list.html">set_norm_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">norm_methods</span> <span class="op">&lt;-</span> <span class="va">norm_methods</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">norm_methods</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"norm_CSS"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/benchdamic/man/runNormalizations.html" class="external-link">runNormalizations</a></span><span class="op">(</span><span class="va">norm_methods</span>, <span class="va">ps</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">zw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/benchdamic/man/weights_ZINB.html" class="external-link">weights_ZINB</a></span><span class="op">(</span><span class="va">ps</span>, design <span class="op">=</span> <span class="va">conditions_col</span><span class="op">)</span></span>
<span><span class="va">DA_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_DA_methods_list.html">set_DA_methods_list</a></span><span class="op">(</span><span class="va">conditions_col</span>, <span class="va">conditions</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The following chunk of code was written for compatibility with</span></span>
<span><span class="co">## a more recent version of Seurat implemented in benchdamic</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">DA_methods</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Seurat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DA_methods</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DA_methods</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">contrast</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="kw">next</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># These methods throw an error, so they must be removed</span></span>
<span><span class="co"># DA_methods &lt;- DA_methods[!names(DA_methods) == 'DA_ALDEx2.1']</span></span>
<span><span class="co"># DA_methods &lt;- DA_methods[!names(DA_methods) == 'DA_corncob.1']</span></span>
<span><span class="co"># DA_methods &lt;- DA_methods[!names(DA_methods) == 'DA_edgeR.1']</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DA_methods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "DA_edgeR.1"         "DA_edgeR.1"         "DA_DESeq2.1"       </span></span>
<span><span class="co">##  [4] "DA_DESeq2.1"        "DA_limma.1"         "DA_limma.1"        </span></span>
<span><span class="co">##  [7] "DA_metagenomeSeq.1" "DA_ALDEx2.1"        "DA_MAST.1"         </span></span>
<span><span class="co">## [10] "DA_Seurat.1"        "ancombc.1"          "wilcox.3"          </span></span>
<span><span class="co">## [13] "wilcox.4"           "ZINQ.9"             "ZINQ.10"           </span></span>
<span><span class="co">## [16] "lefse.12"           "lefse.13"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="run-da-methods">Run DA methods<a class="anchor" aria-label="anchor" href="#run-da-methods"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">DA_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DA_methods</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">DA_output</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span></span>
<span>            <span class="st">"Running method "</span>, <span class="va">i</span>, <span class="st">": "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DA_methods</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">" - "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>        <span class="va">DA_output</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>            error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NULL</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/benchdamic/man/runDA.html" class="external-link">runDA</a></span><span class="op">(</span><span class="va">DA_methods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">ps</span>, weights <span class="op">=</span> <span class="va">zw</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">DA_output</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_flatten.html" class="external-link">list_flatten</a></span><span class="op">(</span><span class="va">DA_output</span>, name_spec <span class="op">=</span> <span class="st">"{inner}"</span><span class="op">)</span></span>
<span>    <span class="va">DA_output</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">discard</a></span><span class="op">(</span><span class="va">DA_output</span>, <span class="va">is.null</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">tim</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##  12.063   1.485  12.008</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="enrichment">Enrichment<a class="anchor" aria-label="anchor" href="#enrichment"></a>
</h2>
<p>Get direction</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">direction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_direction_cols.html">get_direction_cols</a></span><span class="op">(</span><span class="va">DA_output</span>, <span class="va">conditions_col</span>, <span class="va">conditions</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">direction</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 edgeR.TMM        edgeR.TMM.weighted          DESeq2.poscounts </span></span>
<span><span class="co">##                   "logFC"                   "logFC"          "log2FoldChange" </span></span>
<span><span class="co">## DESeq2.poscounts.weighted                 limma.TMM        limma.TMM.weighted </span></span>
<span><span class="co">##          "log2FoldChange"                   "logFC"                   "logFC"</span></span></code></pre>
<p>Create enrichment. Threshold values is based on adjusted p-values</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">enrichment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/benchdamic/man/createEnrichment.html" class="external-link">createEnrichment</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">DA_output</span>,</span>
<span>    priorKnowledge <span class="op">=</span> <span class="va">prior_info</span>,</span>
<span>    enrichmentCol <span class="op">=</span> <span class="st">"taxon_annotation"</span>,</span>
<span>    namesCol <span class="op">=</span> <span class="st">"taxon_name"</span>,</span>
<span>    slot <span class="op">=</span> <span class="st">"pValMat"</span>, colName <span class="op">=</span> <span class="st">"adjP"</span>, type <span class="op">=</span> <span class="st">"pvalue"</span>,</span>
<span>    direction <span class="op">=</span> <span class="va">direction</span>,</span>
<span>    threshold_pvalue <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    threshold_logfc <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    top <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    alternative <span class="op">=</span> <span class="st">"greater"</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<p>Create enrichment plot</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Not a plot. This is a data.frame that should be used as input for</span></span>
<span><span class="co">## the plot_enrichment2 function.</span></span>
<span><span class="va">enrich_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_enrichment.html">plot_enrichment</a></span><span class="op">(</span></span>
<span>    enrichment <span class="op">=</span> <span class="va">enrichment</span>, </span>
<span>    enrichment_col <span class="op">=</span> <span class="st">"taxon_annotation"</span>,</span>
<span>    levels_to_plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hv-associated"</span>, <span class="st">"bv-associated"</span><span class="op">)</span>,</span>
<span>    conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>condB <span class="op">=</span> <span class="st">"HV"</span>, condA <span class="op">=</span> <span class="st">"BV"</span><span class="op">)</span> </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The actual plot.</span></span>
<span><span class="va">enrich_plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_enrichment_2.html">plot_enrichment_2</a></span><span class="op">(</span></span>
<span>    <span class="va">enrich_plot</span>,</span>
<span>    dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>up <span class="op">=</span> <span class="st">'BV'</span>, down <span class="op">=</span> <span class="st">'HV'</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="co"># enrich_plot2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-putative-true-positves-and-true-negatives-ratio">Plot putative true positves and true negatives ratio<a class="anchor" aria-label="anchor" href="#plot-putative-true-positves-and-true-negatives-ratio"></a>
</h2>
<p>Create ‘positives’ object. No thresholds were added.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">positives</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/benchdamic/man/createPositives.html" class="external-link">createPositives</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">DA_output</span>, </span>
<span>    priorKnowledge <span class="op">=</span> <span class="va">prior_info</span>, </span>
<span>    enrichmentCol <span class="op">=</span> <span class="st">"taxon_annotation"</span>, namesCol <span class="op">=</span> <span class="st">"taxon_name"</span>,</span>
<span>    slot <span class="op">=</span> <span class="st">"pValMat"</span>, colName <span class="op">=</span> <span class="st">"adjP"</span>, type <span class="op">=</span> <span class="st">"pvalue"</span>,</span>
<span>    direction <span class="op">=</span> <span class="va">direction</span>,</span>
<span>    threshold_pvalue <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    threshold_logfc <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    top <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    alternative <span class="op">=</span> <span class="st">"greater"</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    TP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DOWN Abundant"</span>, <span class="st">"hv-associated"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UP Abundant"</span>, <span class="st">"bv-associated"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    FP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DOWN Abundant"</span>, <span class="st">"bv-associated"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UP Abundant"</span>, <span class="st">"hv-associated"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mia/man/deprecate.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_meth_class.html">get_meth_class</a></span><span class="op">(</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">'method'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">method_class</span><span class="op">)</span></span></code></pre></div>
<p>Create putative positives plot</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_positives.html">plot_positives</a></span><span class="op">(</span><span class="va">positives</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span> <span class="op">~</span> <span class="op">{</span></span>
<span>        <span class="va">.x</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>                axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>,</span>
<span>                axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>                legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>                strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">plots</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/plot%20positves-1.png" width="1440"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">enrich_plot2</span>, <span class="va">k</span>, ncol <span class="op">=</span> <span class="fl">1</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-4-1.png" width="1440"></p>
</div>
<div class="section level2">
<h2 id="perform-da-with-lefse-wilcox-and-zinq-cauchy-manually">Perform DA with lefse, Wilcox, and ZINQ-Cauchy manually<a class="anchor" aria-label="anchor" href="#perform-da-with-lefse-wilcox-and-zinq-cauchy-manually"></a>
</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Relative abundance (TSS - total sum scaling)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tse_genus</span>, <span class="st">'TSS'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tse_genus</span><span class="op">)</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span> </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## CLR transform</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tse_genus</span>, <span class="st">'CLR'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tse_genus</span><span class="op">)</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># (x + 1) / exp(mean(log(x + 1)))</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Relative abundance + CLR transform</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tse_genus</span>, <span class="st">'TSS + CLR'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tse_genus</span>, <span class="st">'TSS'</span><span class="op">)</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># x / exp(mean(log(x)))</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">tse_genus</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>taxon_name <span class="op">=</span> <span class="va">.feature</span>, sample <span class="op">=</span> <span class="va">.sample</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        taxon_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">taxon_annotation</span><span class="op">)</span>, <span class="st">'Unannotated'</span>, <span class="va">taxon_annotation</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 30</span></span></span>
<span><span class="co">##   taxon_name    sample counts     TSS   CLR `TSS + CLR` dataset gender body_site</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> genus:Lactob… S250      565 30.8     4.66        4.66 Ravel_… female vagina   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> genus:Prevot… S250      194 10.6     3.60        3.60 Ravel_… female vagina   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> genus:Megasp… S250      677 36.9     4.85        4.85 Ravel_… female vagina   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> genus:Sneath… S250       24  1.36    1.54        1.54 Ravel_… female vagina   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> genus:Atopob… S250      227 12.4     3.76        3.76 Ravel_… female vagina   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> genus:Strept… S250        0  0.054<span style="text-decoration: underline;">5</span> -<span style="color: #BB0000;">1.67</span>       -<span style="color: #BB0000;">1.67</span> Ravel_… female vagina   </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 21 more variables: ncbi_accession &lt;chr&gt;, library_size &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   sequencing_platform &lt;chr&gt;, pmid &lt;dbl&gt;, study_condition &lt;fct&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   sequencing_method &lt;chr&gt;, variable_region_16s &lt;chr&gt;, country &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   number_bases &lt;dbl&gt;, ethnicity &lt;chr&gt;, ph &lt;dbl&gt;, nugent_score &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   nugent_score_category &lt;chr&gt;, community_group &lt;chr&gt;, kingdom &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   class &lt;chr&gt;, order &lt;chr&gt;, family &lt;chr&gt;, genus &lt;chr&gt;, species &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   taxon_annotation &lt;chr&gt;</span></span></span></code></pre>
<div class="section level3">
<h3 id="wilcox">Wilcox<a class="anchor" aria-label="anchor" href="#wilcox"></a>
</h3>
<p>Define function:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calcWilcox</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">val_col</span>, <span class="va">log</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">## Separate components</span></span>
<span>    <span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">taxon_name</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">taxa_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span></span>
<span>    <span class="va">taxa_annotations</span> <span class="op">&lt;-</span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'taxon'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">## Perform Wilcoxon test </span></span>
<span>    <span class="va">pvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'double'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pvalues</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">taxa_names</span> </span>
<span>    <span class="va">formula_chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">val_col</span>, <span class="st">' ~ study_condition'</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pvalues</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">taxa</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">formula_chr</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span>        <span class="va">pvalues</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">p.value</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## Adjust P-values</span></span>
<span>    <span class="va">adj_pvalues</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">pvalues</span>, method <span class="op">=</span> <span class="st">'fdr'</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">## Calculate fold change</span></span>
<span>    <span class="va">log_fold_change</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'double'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">lll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'double'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">log_fold_change</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">taxa</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>        <span class="va">healthy</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">study_condition</span> <span class="op">==</span> <span class="st">'healthy'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="va">y</span><span class="op">[[</span><span class="va">val_col</span><span class="op">]</span><span class="op">]</span><span class="op">}</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="va">bv</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">study_condition</span> <span class="op">==</span> <span class="st">'bacterial_vaginosis'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="va">y</span><span class="op">[[</span><span class="va">val_col</span><span class="op">]</span><span class="op">]</span><span class="op">}</span><span class="op">(</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">bv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">bv</span><span class="op">)</span></span>
<span>        <span class="va">healthy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">healthy</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">log</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">log_fold_change</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">bv</span> <span class="op">-</span> <span class="va">healthy</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">bv</span> <span class="op">&gt;=</span> <span class="va">healthy</span><span class="op">)</span> <span class="op">{</span> <span class="co"># control is healthy, condition of interest is bv</span></span>
<span>                 <span class="va">log_fold_change</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">bv</span> <span class="op">/</span> <span class="va">healthy</span><span class="op">)</span></span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">bv</span> <span class="op">&lt;</span> <span class="va">healthy</span><span class="op">)</span> <span class="op">{</span></span>
<span>                 <span class="va">log_fold_change</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">healthy</span> <span class="op">/</span> <span class="va">bv</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## Combine results and annotations</span></span>
<span>    <span class="va">pval_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        taxon_name <span class="op">=</span> <span class="va">taxa_names</span>,</span>
<span>        rawP <span class="op">=</span> <span class="va">pvalues</span>,</span>
<span>        adjP <span class="op">=</span> <span class="va">adj_pvalues</span>,</span>
<span>        logFC <span class="op">=</span> <span class="va">log_fold_change</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">pval_results</span>, <span class="va">taxa_annotations</span>, by <span class="op">=</span> <span class="st">'taxon_name'</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Perform statistical test:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wilcox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    wilcox_counts <span class="op">=</span> <span class="fu">calcWilcox</span><span class="op">(</span><span class="va">data</span>, <span class="st">'counts'</span><span class="op">)</span>,</span>
<span>    wilcox_relab <span class="op">=</span> <span class="fu">calcWilcox</span><span class="op">(</span><span class="va">data</span>, <span class="st">'TSS'</span><span class="op">)</span>,</span>
<span>    wilcox_clr <span class="op">=</span> <span class="fu">calcWilcox</span><span class="op">(</span><span class="va">data</span>, <span class="st">'CLR'</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    wilcox_relab_clr <span class="op">=</span> <span class="fu">calcWilcox</span><span class="op">(</span><span class="va">data</span>, <span class="st">'TSS + CLR'</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">'method'</span><span class="op">)</span></span></code></pre></div>
<p>Filter DA taxa</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wilcox_DA</span> <span class="op">&lt;-</span> <span class="va">wilcox</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">adjP</span> <span class="op">&lt;=</span> <span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">logFC</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>DA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">logFC</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"OA"</span>, <span class="st">"UA"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plot</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wilcox_DA</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_annotation</span> <span class="op">!=</span> <span class="st">'Unannotated'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">method</span>, <span class="va">taxon_annotation</span>, <span class="va">DA</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">DA</span> <span class="op">==</span> <span class="st">'UA'</span>, <span class="op">-</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'wilcox_'</span>, <span class="st">''</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">method</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">taxon_annotation</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">'dodge'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">'Wilcoxon test'</span>,</span>
<span>        y <span class="op">=</span> <span class="st">'Number of DA taxa'</span>, x <span class="op">=</span> <span class="st">'Transformation method'</span> </span>
<span>    <span class="op">)</span> </span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/plot%20numbers%20of%20taxa-1.png" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="co"># scale_y_continuous(limits = c(-3, 11), breaks = seq(-3, 11, 2))</span></span></code></pre></div>
<p>Plot the abundances of the taxa that were incorrect</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">incorrect_taxa_wilcox_clr</span> <span class="op">&lt;-</span> <span class="va">wilcox_DA</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">method</span> <span class="op">==</span> <span class="st">'wilcox_clr'</span>, <span class="va">DA</span> <span class="op">==</span> <span class="st">'UA'</span>, </span>
<span>        <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'bv-associated'</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">taxon_name</span><span class="op">)</span></span>
<span><span class="va">incorrect_taxa_wilcox_clr</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "genus:Actinomyces"        "genus:Corynebacterium"   </span></span>
<span><span class="co">## [3] "genus:Gemella"            "genus:Mobiluncus"        </span></span>
<span><span class="co">## [5] "genus:Peptostreptococcus" "genus:Staphylococcus"    </span></span>
<span><span class="co">## [7] "genus:Streptococcus"</span></span></code></pre>
<p>Let’s plot their values for each matrix</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'counts'</span>, <span class="st">'TSS'</span>, <span class="st">'CLR'</span>, <span class="st">'TSS + CLR'</span><span class="op">)</span></span>
<span><span class="va">l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'list'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">transformations</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">l1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">transformations</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">transformations</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tse_genus</span>, <span class="va">transformations</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">l1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[</span><span class="va">incorrect_taxa_wilcox_clr</span>,<span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">'taxon_name'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">wilcox_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">l1</span>, .id <span class="op">=</span> <span class="st">'transformation'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>        <span class="va">y</span>, cols <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, values_to <span class="op">=</span> <span class="st">'value'</span>, names_to <span class="op">=</span> <span class="st">'sample'</span></span>
<span>    <span class="op">)</span><span class="op">}</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mia/man/deprecate.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sample'</span>, <span class="st">'study_condition'</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">'sample'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in left_join({: Detected an unexpected many-to-many relationship between `x` and `y`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Row 1 of `x` matches multiple rows in `y`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Row 1 of `y` matches multiple rows in `x`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> If a many-to-many relationship is expected, set `relationship =</span></span>
<span><span class="co">##   "many-to-many"` to silence this warning.</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">wilcox_raw</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">##   transformation taxon_name        sample value study_condition    </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> counts         genus:Actinomyces S250       0 bacterial_vaginosis</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> counts         genus:Actinomyces S250       0 bacterial_vaginosis</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> counts         genus:Actinomyces S250       0 bacterial_vaginosis</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> counts         genus:Actinomyces S250       0 bacterial_vaginosis</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> counts         genus:Actinomyces S250       0 bacterial_vaginosis</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> counts         genus:Actinomyces S250       0 bacterial_vaginosis</span></span></code></pre>
<p>Box plot of incorrect values:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wilcox_genus_plot</span> <span class="op">&lt;-</span> <span class="va">wilcox_raw</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxon_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'genus:'</span>, <span class="st">''</span>, <span class="va">taxon_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        value <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">transformation</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"counts"</span>, <span class="st">"TSS"</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">value</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">value</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># mutate(value = log(value + 1)) |&gt; </span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>transformation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>        <span class="va">transformation</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'counts'</span>, <span class="st">'TSS'</span>, <span class="st">'CLR'</span>, <span class="st">'TSS + CLR'</span> <span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Counts'</span>, <span class="st">'Relative abundance'</span>, <span class="st">'CLR'</span>, <span class="st">'Relative abundace + CLR'</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>study_condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>        <span class="va">study_condition</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'healthy'</span>, <span class="st">'bacterial_vaginosis'</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'HV'</span>, <span class="st">'BV'</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">taxon_name</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">study_condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">transformation</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        y <span class="op">=</span> <span class="st">'log2(Abundance values)'</span>, x <span class="op">=</span> <span class="st">'Genus'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'dodgerblue1'</span>, <span class="st">'firebrick1'</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There was 1 warning in `mutate()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `value = case_when(...)`.</span></span>
<span><span class="co">## Caused by warning in `log()`:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> NaNs produced</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wilcox_genus_plot</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/plot%20abundance%20values-1.png" width="700"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxon_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'genus:'</span>, <span class="st">''</span>, <span class="va">taxon_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Actinomyces'</span>, <span class="st">'Corynebacterium'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_condition</span>, <span class="va">taxon_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>        mean_counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>,</span>
<span>        sd_counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>,</span>
<span>        median_counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>,</span>
<span>        </span>
<span>        mean_TSS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">TSS</span><span class="op">)</span>,</span>
<span>        sd_TSS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">TSS</span><span class="op">)</span>,</span>
<span>        median_TSS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">TSS</span><span class="op">)</span>,</span>
<span>        </span>
<span>        mean_CLR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">CLR</span><span class="op">)</span>,</span>
<span>        sd_CLR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">CLR</span><span class="op">)</span>,</span>
<span>        median_CLR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">CLR</span><span class="op">)</span>,</span>
<span>        </span>
<span>        mean_TSS_CLR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`TSS + CLR`</span><span class="op">)</span>,</span>
<span>        sd_TSS_CLR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">`TSS + CLR`</span><span class="op">)</span>,</span>
<span>        median_TSS_CLR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">`TSS + CLR`</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">taxon_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/modify.html" class="external-link">modify_if</a></span><span class="op">(</span>.p <span class="op">=</span> <span class="va">is.numeric</span>, .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"median"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">stats</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 10</span></span></span>
<span><span class="co">##   study_condition     taxon_name  mean_counts sd_counts mean_TSS sd_TSS mean_CLR</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> healthy             Actinomyces        0.38      1.66     0.07   0.1     -<span style="color: #BB0000;">0.5</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> bacterial_vaginosis Actinomyces        2.78      7.78     0.17   0.29    -<span style="color: #BB0000;">1.35</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> healthy             Corynebact…        6.53     29.1      0.42   1.69    -<span style="color: #BB0000;">0.03</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> bacterial_vaginosis Corynebact…        9.45     26.3      0.48   1.19    -<span style="color: #BB0000;">0.89</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: sd_CLR &lt;dbl&gt;, mean_TSS_CLR &lt;dbl&gt;, sd_TSS_CLR &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">types_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"counts$"</span>, <span class="st">"TSS$"</span>, <span class="st">"[^(TSS)]_CLR$"</span>, <span class="st">"TSS_CLR$"</span><span class="op">)</span></span>
<span><span class="va">new_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">stats</span>, <span class="va">taxon_name</span>, <span class="va">study_condition</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">types_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">types_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">mean_vals</span> <span class="op">&lt;-</span> <span class="va">stats</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="va">pos</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span></span>
<span>    <span class="va">sd_vals</span> <span class="op">&lt;-</span> <span class="va">stats</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"sd"</span>, <span class="va">pos</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span></span>
<span>    <span class="va">new_col_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"mean_"</span>, <span class="st">""</span>, <span class="va">pos</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">new_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">mean_vals</span>, <span class="st">"\u00B1"</span>, <span class="va">sd_vals</span><span class="op">)</span></span>
<span>    <span class="va">new_stats</span><span class="op">[[</span><span class="va">new_col_name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">new_col</span></span>
<span><span class="op">}</span></span>
<span><span class="va">new_stats</span> <span class="op">&lt;-</span> <span class="va">new_stats</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>        Taxon <span class="op">=</span> <span class="va">taxon_name</span>, Condition <span class="op">=</span> <span class="va">study_condition</span>,</span>
<span>        Counts <span class="op">=</span> <span class="va">counts</span>, `TSS+CLR` <span class="op">=</span> <span class="va">TSS_CLR</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        Condition <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">Condition</span> <span class="op">==</span> <span class="st">"healthy"</span> <span class="op">~</span> <span class="st">"HV"</span>,</span>
<span>            <span class="va">Condition</span> <span class="op">==</span> <span class="st">"bacterial_vaginosis"</span> <span class="op">~</span> <span class="st">"VB"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wilcox</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        sig <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">adjP</span> <span class="op">&lt;=</span> <span class="fl">0.1</span>, <span class="st">'*'</span>, <span class="st">''</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sig2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">logFC</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">' '</span>, <span class="va">sig</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxon_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'genus:'</span>, <span class="st">''</span>, <span class="va">taxon_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxon_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">taxon_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Actinomyces'</span>, <span class="st">'Corynebacterium'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">taxon_name</span>, <span class="va">logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">sig2</span>, group <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, </span>
<span>        position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">'LogFC of taxa identified as significant (adjP &lt;= 0.1) by CLR'</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">'logFC is indicated on top of bars. * means significant'</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/plot%20fold%20change-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="lefse">Lefse<a class="anchor" aria-label="anchor" href="#lefse"></a>
</h3>
<p>Define a function for running Lefse:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calcLefse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">assay</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lefser2.html">lefser2</a></span><span class="op">(</span></span>
<span>        <span class="va">dat</span>, kruskal.threshold <span class="op">=</span> <span class="fl">0.05</span>, wilcox.threshold <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>        lda.threshold <span class="op">=</span> <span class="fl">0</span>, groupCol <span class="op">=</span> <span class="st">'study_condition'</span>, assay <span class="op">=</span> <span class="va">assay</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">adj_pvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">kw_pvalues</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">res</span>, rawP <span class="op">=</span> <span class="va">kw_pvalues</span>, adjP <span class="op">=</span> <span class="va">adj_pvalues</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># res &lt;- lefser2(</span></span>
<span>    <span class="co">#     dat, kruskal.threshold = 0.05, wilcox.threshold = 0.05, </span></span>
<span>    <span class="co">#     lda.threshold = 0, groupCol = 'study_condition', assay = assay ,</span></span>
<span>    <span class="co">#     log = log</span></span>
<span>    <span class="co"># )</span></span>
<span>    </span>
<span>    <span class="co">## Add some made up rawP and adjP</span></span>
<span>    <span class="co"># res |&gt; </span></span>
<span>    <span class="co">#     dplyr::mutate(</span></span>
<span>    <span class="co">#         rawP = kw_pvalues,</span></span>
<span>    <span class="co">#         adjP = stats::p.adjust(rawP, method = 'fdr')</span></span>
<span>    <span class="co">#     )</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Run lefse</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taxa_annotations</span> <span class="op">&lt;-</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'taxon'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lefse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    lefse_counts <span class="op">=</span> <span class="fu">calcLefse</span><span class="op">(</span><span class="va">tse_genus</span>, <span class="st">'counts'</span><span class="op">)</span>,</span>
<span>    lefse_relab <span class="op">=</span> <span class="fu">calcLefse</span><span class="op">(</span><span class="va">tse_genus</span>, <span class="st">'TSS'</span><span class="op">)</span>,</span>
<span>    lefse_clr <span class="op">=</span> <span class="fu">calcLefse</span><span class="op">(</span><span class="va">tse_genus</span>, <span class="st">'CLR'</span><span class="op">)</span>,</span>
<span>    lefse_relab_clr <span class="op">=</span> <span class="fu">calcLefse</span><span class="op">(</span><span class="va">tse_genus</span>, <span class="st">'TSS + CLR'</span><span class="op">)</span></span>
<span><span class="op">)</span>  <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">'method'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        DA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">scores</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">'OA'</span>, <span class="st">'UA'</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>taxon_name <span class="op">=</span> <span class="st">'Names'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mia/man/deprecate.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">taxa_annotations</span>, by <span class="op">=</span> <span class="st">'taxon_name'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lefse</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         method         taxon_name    scores   kw_pvalues         rawP</span></span>
<span><span class="co">## 1 lefse_counts  genus:Actinomyces 0.6885880 2.016389e-03 2.016389e-03</span></span>
<span><span class="co">## 2 lefse_counts   genus:Aerococcus 1.4936473 7.902396e-07 7.902396e-07</span></span>
<span><span class="co">## 3 lefse_counts genus:Anaerococcus 1.5154215 1.849079e-07 1.849079e-07</span></span>
<span><span class="co">## 4 lefse_counts genus:Anaeroglobus 0.3013052 4.720803e-05 4.720803e-05</span></span>
<span><span class="co">## 5 lefse_counts    genus:Atopobium 1.7981129 3.482931e-08 3.482931e-08</span></span>
<span><span class="co">## 6 lefse_counts    genus:Bulleidia 0.4997263 8.644443e-04 8.644443e-04</span></span>
<span><span class="co">##           adjP DA taxon_annotation</span></span>
<span><span class="co">## 1 3.907376e-03 OA    bv-associated</span></span>
<span><span class="co">## 2 7.902396e-06 OA    bv-associated</span></span>
<span><span class="co">## 3 2.033986e-06 OA      Unannotated</span></span>
<span><span class="co">## 4 3.304562e-04 OA      Unannotated</span></span>
<span><span class="co">## 5 4.527811e-07 OA    bv-associated</span></span>
<span><span class="co">## 6 3.457777e-03 OA      Unannotated</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lefse_DA</span> <span class="op">&lt;-</span> <span class="va">lefse</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">adjP</span> <span class="op">&lt;=</span> <span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>DA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">scores</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"OA"</span>, <span class="st">"UA"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plot lefse results:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lefse_DA</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_annotation</span> <span class="op">!=</span> <span class="st">'Unannotated'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">method</span>, <span class="va">taxon_annotation</span>, <span class="va">DA</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">DA</span> <span class="op">==</span> <span class="st">'UA'</span>, <span class="op">-</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'lefse_'</span>, <span class="st">''</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">method</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">taxon_annotation</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">'dodge'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">'LEfSe test'</span>,</span>
<span>        y <span class="op">=</span> <span class="st">'Number of DA taxa'</span>, x <span class="op">=</span> <span class="st">'Transformation method'</span> </span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="co"># scale_y_continuous(limits = c(-3, 11), breaks = seq(-3, 11, 2))</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">incorrect_taxa_lefse_clr</span> <span class="op">&lt;-</span> <span class="va">lefse_DA</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">method</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lefse_clr'</span>, <span class="st">'lefse_relab_clr'</span><span class="op">)</span>, <span class="va">DA</span> <span class="op">==</span> <span class="st">'UA'</span>, </span>
<span>        <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'bv-associated'</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">taxon_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">incorrect_taxa_lefse_clr</span> <span class="co">## the same as in wilcox.</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "genus:Actinomyces"     "genus:Corynebacterium" "genus:Mobiluncus"     </span></span>
<span><span class="co">## [4] "genus:Staphylococcus"  "genus:Streptococcus"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="zinq">ZINQ<a class="anchor" aria-label="anchor" href="#zinq"></a>
</h3>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calcZINQ</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">val_col</span>, <span class="va">y_Cord</span> <span class="op">=</span> <span class="st">'D'</span>, <span class="va">log</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">dat</span><span class="op">$</span><span class="va">taxon_name</span><span class="op">)</span></span>
<span>    <span class="va">taxa_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">taxa_annotations</span> <span class="op">&lt;-</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'taxon'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">pvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'double'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pvalues</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">taxa_names</span></span>
<span>    <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">val_col</span>, <span class="st">' ~ study_condition'</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pvalues</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">taxa</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>        </span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>            error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NULL</span>, <span class="op">{</span></span>
<span>                <span class="fu">ZINQ</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ZINQ/man/ZINQ_tests.html" class="external-link">ZINQ_tests</a></span><span class="op">(</span></span>
<span>                    formula.logistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">form</span><span class="op">)</span>, </span>
<span>                    formula.quantile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">form</span><span class="op">)</span>,</span>
<span>                    C <span class="op">=</span> <span class="st">'study_condition'</span>, y_CorD <span class="op">=</span> <span class="va">y_Cord</span>, data <span class="op">=</span> <span class="va">df</span></span>
<span>                <span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">pvalues</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="va">pvalues</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">ZINQ</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ZINQ/man/ZINQ_combination.html" class="external-link">ZINQ_combination</a></span><span class="op">(</span><span class="va">res</span>, method <span class="op">=</span> <span class="st">'Cauchy'</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">adj_pvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">pvalues</span>, method <span class="op">=</span> <span class="st">'fdr'</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">log_fold_change</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'double'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">log_fold_change</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">taxa</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>        <span class="va">healthy</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">study_condition</span> <span class="op">==</span> <span class="st">'healthy'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="va">y</span><span class="op">[[</span><span class="va">val_col</span><span class="op">]</span><span class="op">]</span><span class="op">}</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="va">bv</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">study_condition</span> <span class="op">==</span> <span class="st">'bacterial_vaginosis'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="op">{</span>\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="va">y</span><span class="op">[[</span><span class="va">val_col</span><span class="op">]</span><span class="op">]</span><span class="op">}</span><span class="op">(</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">log</span><span class="op">)</span> <span class="op">{</span> <span class="co"># If log, revert with exp</span></span>
<span>            <span class="va">healthy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">healthy</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">bv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">bv</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>            <span class="va">healthy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">healthy</span><span class="op">)</span></span>
<span>            <span class="va">bv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">bv</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">bv</span> <span class="op">&gt;=</span> <span class="va">healthy</span><span class="op">)</span> <span class="op">{</span> <span class="co"># control is healthy, condition of interest is bv</span></span>
<span>            <span class="va">log_fold_change</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">bv</span> <span class="op">/</span> <span class="va">healthy</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">bv</span> <span class="op">&lt;</span> <span class="va">healthy</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">log_fold_change</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">healthy</span> <span class="op">/</span> <span class="va">bv</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## Combine results and annotations</span></span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        taxon_name <span class="op">=</span> <span class="va">taxa_names</span>,</span>
<span>        rawP <span class="op">=</span> <span class="va">pvalues</span>,</span>
<span>        adjP <span class="op">=</span> <span class="va">adj_pvalues</span>,</span>
<span>        logFC <span class="op">=</span> <span class="va">log_fold_change</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span>    <span class="co"># dplyr::left_join(output, taxa_annotations, by = 'taxon_name')</span></span>
<span>    </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Run ZINQ</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zinq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    zinq_counts <span class="op">=</span> <span class="fu">calcZINQ</span><span class="op">(</span><span class="va">data</span>, <span class="st">'counts'</span>, y_Cord <span class="op">=</span> <span class="st">'D'</span><span class="op">)</span>,</span>
<span>    zinq_relab <span class="op">=</span> <span class="fu">calcZINQ</span><span class="op">(</span><span class="va">data</span>, <span class="st">'TSS'</span>, y_Cord <span class="op">=</span> <span class="st">'C'</span><span class="op">)</span>,</span>
<span>    zinq_clr <span class="op">=</span> <span class="fu">calcZINQ</span><span class="op">(</span><span class="va">data</span>, <span class="st">'CLR'</span>, y_Cord <span class="op">=</span> <span class="st">'C'</span><span class="op">)</span>,</span>
<span>    zinq_relab_clr <span class="op">=</span> <span class="fu">calcZINQ</span><span class="op">(</span><span class="va">data</span>, <span class="st">'TSS + CLR'</span>, y_Cord <span class="op">=</span> <span class="st">'C'</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">'method'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        DA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">logFC</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">'OA'</span>, <span class="st">'UA'</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mia/man/deprecate.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">taxa_annotations</span>, by <span class="op">=</span> <span class="st">'taxon_name'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">zinq_DA</span> <span class="op">&lt;-</span> <span class="va">zinq</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">adjP</span> <span class="op">&lt;=</span> <span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">logFC</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>DA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">logFC</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"OA"</span>, <span class="st">"UA"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plot ZINQ results</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zinq_plot</span> <span class="op">&lt;-</span> <span class="va">zinq_DA</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_annotation</span> <span class="op">!=</span> <span class="st">'Unannotated'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">method</span>, <span class="va">taxon_annotation</span>, <span class="va">DA</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">DA</span> <span class="op">==</span> <span class="st">'UA'</span>, <span class="op">-</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'lefse_'</span>, <span class="st">''</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">method</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">taxon_annotation</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">'dodge'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">'ZINQ test'</span>,</span>
<span>        y <span class="op">=</span> <span class="st">'Number of DA taxa'</span>, x <span class="op">=</span> <span class="st">'Transformation method'</span> </span>
<span>    <span class="op">)</span></span>
<span>    <span class="co"># scale_y_continuous(limits = c(-3, 13), breaks = seq(-3, 13, 2))</span></span>
<span><span class="va">zinq_plot</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">incorrect_taxa_lefse_clr</span> <span class="op">&lt;-</span> <span class="va">zinq_DA</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">method</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'zinq_clr'</span>, <span class="st">'zinq_relab_clr'</span><span class="op">)</span>, <span class="va">DA</span> <span class="op">==</span> <span class="st">'UA'</span>, </span>
<span>        <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'bv-associated'</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">taxon_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">incorrect_taxa_lefse_clr</span> <span class="co">## the same as in wilcox.</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "genus:Aerococcus"  "genus:Gardnerella"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="ancom-bc-metagenomeseq-and-deseq2">ANCOM-BC, MetagenomeSeq, and DESEQ2<a class="anchor" aria-label="anchor" href="#ancom-bc-metagenomeseq-and-deseq2"></a>
</h2>
<p>ANCOM-BC</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ancombc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">DA_output</span><span class="op">$</span><span class="va">ancombc.none</span><span class="op">$</span><span class="va">statInfo</span><span class="op">)</span></span>
<span><span class="va">ancombc</span><span class="op">$</span><span class="va">taxon_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ancombc</span><span class="op">)</span></span>
<span><span class="va">ancombc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/deprecate.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ancombc</span>, <span class="va">taxa_annotations</span>, by <span class="op">=</span> <span class="st">"taxon_name"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">taxon_name</span>, <span class="va">taxon_annotation</span><span class="op">)</span></span>
<span><span class="va">ancombc</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">q_val</span> <span class="op">&lt;=</span> <span class="fl">0.1</span>, <span class="va">lfc</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'bv-associated'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">taxon_name</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## character(0)</span></span></code></pre>
<p>MetagenomeSeq</p>
<p>DESEQ2</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deseq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">DA_output</span><span class="op">$</span><span class="va">DESeq2.poscounts</span><span class="op">$</span><span class="va">statInfo</span><span class="op">)</span></span>
<span><span class="va">deseq</span><span class="op">$</span><span class="va">taxon_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">deseq</span><span class="op">)</span></span>
<span><span class="va">deseq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/deprecate.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">deseq</span>, <span class="va">taxa_annotations</span>, by <span class="op">=</span> <span class="st">"taxon_name"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">taxon_name</span>, <span class="va">taxon_annotation</span><span class="op">)</span></span>
<span><span class="va">deseq</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">padj</span> <span class="op">&lt;=</span> <span class="fl">0.1</span>, <span class="va">log2FoldChange</span> <span class="op">&lt;</span> <span class="fl">0</span>,</span>
<span>           <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'bv-associated'</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">taxon_name</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "genus:Staphylococcus"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="plots-of-bv-associated-genera">Plots of BV-associated genera<a class="anchor" aria-label="anchor" href="#plots-of-bv-associated-genera"></a>
</h2>
<p>These are all of the BV-associated bacteria present in the Ravel_2011
dataset. This is independent of any statistical test or effect size
calculation.</p>
<div class="section level3">
<h3 id="clr">CLR<a class="anchor" aria-label="anchor" href="#clr"></a>
</h3>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'bv-associated'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxon_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"^genus:"</span>, <span class="st">""</span>, <span class="va">taxon_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># mutate(CLR = log(CLR + 1)) |&gt; </span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">taxon_name</span>, <span class="va">CLR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">study_condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">'CLR values of BV-associated bacteria'</span>,</span>
<span>        x <span class="op">=</span> <span class="st">'Genus'</span>, y <span class="op">=</span> <span class="st">'log(CLR)'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="relative-abundance">Relative abundance<a class="anchor" aria-label="anchor" href="#relative-abundance"></a>
</h3>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'bv-associated'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxon_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"^genus:"</span>, <span class="st">""</span>, <span class="va">taxon_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TSS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">TSS</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">taxon_name</span>, <span class="va">TSS</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">study_condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Relative abundance values of BV-associated bacteria'</span>,</span>
<span>         y <span class="op">=</span> <span class="st">'log2(relative abundance)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="compositions-with-tss-data">Compositions with TSS data<a class="anchor" aria-label="anchor" href="#compositions-with-tss-data"></a>
</h3>
<p>order of taxa</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_set</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">nugent_score_category</span> <span class="op">==</span> <span class="st">'low'</span>,</span>
<span>        <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'hv-associated'</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">TSS</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">second_set</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">nugent_score_category</span> <span class="op">==</span> <span class="st">'high'</span>,</span>
<span>        <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'hv-associated'</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">TSS</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span></span>
<span><span class="va">samples_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">first_set</span>, <span class="va">second_set</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sample</span>, levels <span class="op">=</span> <span class="va">samples_order</span><span class="op">)</span>,</span>
<span>        nugent_score_category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">nugent_score_category</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'low'</span>, <span class="st">'high'</span><span class="op">)</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Low Nugent score'</span>, <span class="st">'High Nugent score'</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        taxon_annotation <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">"hv-associated"</span> <span class="op">~</span> <span class="st">"Health-associated"</span>,</span>
<span>            <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">"bv-associated"</span> <span class="op">~</span> <span class="st">"BV-associated"</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">taxon_annotation</span></span>
<span>        <span class="op">)</span>,</span>
<span>        taxon_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">taxon_annotation</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Health-associated'</span>, <span class="st">'BV-associated'</span>, <span class="st">'Unannotated'</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sample</span>, <span class="va">TSS</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">taxon_annotation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'gray60'</span>, <span class="st">'firebrick2'</span>, <span class="st">'dodgerblue2'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">"Samples"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Relative abundance values (TSS)"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">nugent_score_category</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="va">p1</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sample</span>, levels <span class="op">=</span> <span class="va">samples_order</span><span class="op">)</span>,</span>
<span>        nugent_score_category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">nugent_score_category</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'low'</span>, <span class="st">'high'</span><span class="op">)</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Low Nugent score'</span>, <span class="st">'High Nugent score'</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        taxon_annotation <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">"hv-associated"</span> <span class="op">~</span> <span class="st">"Health-associated"</span>,</span>
<span>            <span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">"bv-associated"</span> <span class="op">~</span> <span class="st">"BV-associated"</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">taxon_annotation</span></span>
<span>        <span class="op">)</span>,</span>
<span>        taxon_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">taxon_annotation</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Health-associated'</span>, <span class="st">'BV-associated'</span>, <span class="st">'Unannotated'</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">CLR</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">taxon_annotation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'gray60'</span>, <span class="st">'firebrick2'</span>, <span class="st">'dodgerblue2'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">"Samples"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Geometric mean normalization (exp(CLR))"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">nugent_score_category</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="va">p2</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="distributions">Distributions<a class="anchor" aria-label="anchor" href="#distributions"></a>
</h2>
<p>Get Latobacillus relative abundance per sample</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">taxon_name</span> <span class="op">==</span> <span class="st">'genus:Lactobacillus'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sample</span>, lact_tss <span class="op">=</span> <span class="va">TSS</span>, lact_clr <span class="op">=</span> <span class="va">CLR</span><span class="op">)</span></span>
<span><span class="va">data_with_lact</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/deprecate.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">sample_sizes</span>, by <span class="op">=</span> <span class="st">'sample'</span><span class="op">)</span></span></code></pre></div>
<p>Relative abundance vs CLR all taxa</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_lact</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">TSS</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">CLR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">study_condition</span>, size <span class="op">=</span> <span class="va">lact_tss</span><span class="op">)</span>, </span>
<span>        alpha <span class="op">=</span> <span class="fl">0.3</span>, position <span class="op">=</span> <span class="st">'jitter'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">'Relative abundace vs CLR per genus'</span>,</span>
<span>        x <span class="op">=</span> <span class="st">'log(TSS + 1)'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Relative abundance vs CLR BV-associated</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_lact</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_annotation</span> <span class="op">==</span> <span class="st">'bv-associated'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">TSS</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">CLR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">study_condition</span>, size <span class="op">=</span> <span class="va">lact_tss</span><span class="op">)</span>, </span>
<span>        alpha <span class="op">=</span> <span class="fl">0.3</span>, position <span class="op">=</span> <span class="st">'jitter'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">'Relative abundace vs CLR'</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">'BV-associated genera only'</span>,</span>
<span>        x <span class="op">=</span> <span class="st">'log(TSS + 1)'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Lactobacillus Rel. Ab.'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>Plotting log(CLR) vs log(Relab) of Lactobacillus, Prevotella,
Actinomyces, and Corynebacterium.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_1b</span> <span class="op">&lt;-</span> <span class="va">data_with_lact</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_name</span> <span class="op">==</span> <span class="st">'genus:Actinomyces'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        study_condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">study_condition</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bacterial_vaginosis'</span>, <span class="st">'healthy'</span><span class="op">)</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'BV'</span>, <span class="st">'HV'</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">TSS</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">CLR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">study_condition</span>, size <span class="op">=</span> <span class="va">lact_tss</span><span class="op">)</span>, </span>
<span>        alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        <span class="co"># title = 'Relative abundace vs CLR',</span></span>
<span>        title <span class="op">=</span> <span class="st">'Actinomyces (BV-associated)'</span>,</span>
<span>        x <span class="op">=</span> <span class="st">'log(TSS + 1)'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Condition'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Lactobacillus Rel. Ab.'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_2b</span> <span class="op">&lt;-</span> <span class="va">data_with_lact</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_name</span> <span class="op">==</span> <span class="st">'genus:Corynebacterium'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        study_condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">study_condition</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bacterial_vaginosis'</span>, <span class="st">'healthy'</span><span class="op">)</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'BV'</span>, <span class="st">'HV'</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">TSS</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">CLR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">study_condition</span>, size <span class="op">=</span> <span class="va">lact_tss</span><span class="op">)</span>, </span>
<span>        alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        <span class="co"># title = 'Relative abundace vs CLR',</span></span>
<span>        title <span class="op">=</span> <span class="st">'Corynebacterium (BV-associated)'</span>,</span>
<span>        x <span class="op">=</span> <span class="st">'log(TSS + 1)'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Condition'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Lactobacillus Rel. Ab.'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_3b</span> <span class="op">&lt;-</span> <span class="va">data_with_lact</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_name</span> <span class="op">==</span> <span class="st">'genus:Prevotella'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        study_condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">study_condition</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bacterial_vaginosis'</span>, <span class="st">'healthy'</span><span class="op">)</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'BV'</span>, <span class="st">'HV'</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">TSS</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">CLR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">study_condition</span>, size <span class="op">=</span> <span class="va">lact_tss</span><span class="op">)</span>, </span>
<span>        alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        <span class="co"># title = 'Relative abundace vs CLR',</span></span>
<span>        title <span class="op">=</span> <span class="st">'Prevotella (BV-associated)'</span>,</span>
<span>        x <span class="op">=</span> <span class="st">'log(TSS + 1)'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Condition'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Lactobacillus Rel. Ab.'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_4b</span> <span class="op">&lt;-</span> <span class="va">data_with_lact</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">taxon_name</span> <span class="op">==</span> <span class="st">'genus:Lactobacillus'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        study_condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">study_condition</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bacterial_vaginosis'</span>, <span class="st">'healthy'</span><span class="op">)</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'BV'</span>, <span class="st">'HV'</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">TSS</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">CLR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">study_condition</span>, size <span class="op">=</span> <span class="va">lact_tss</span><span class="op">)</span>, </span>
<span>        alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        <span class="co"># title = 'Relative abundace vs CLR',</span></span>
<span>        title <span class="op">=</span> <span class="st">'Lactobacillus (HV)'</span>,</span>
<span>        x <span class="op">=</span> <span class="st">'log(TSS + 1)'</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Condition'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Lactobacillus Rel. Ab.'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plotsb</span> <span class="op">&lt;-</span> <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>    <span class="va">plot_4b</span>, <span class="va">plot_3b</span>, <span class="va">plot_1b</span>, <span class="va">plot_2b</span>, align <span class="op">=</span> <span class="st">'hv'</span>,</span>
<span>    common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">'bottom'</span>, </span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'a)'</span>, <span class="st">'b)'</span>, <span class="st">'c)'</span>, <span class="st">'d)'</span><span class="op">)</span></span>
<span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotsb</span></span></code></pre></div>
<p><img src="Ravel_2011_16S_BV_files/figure-html/unnamed-chunk-26-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Etc/UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] doRNG_1.8.6                            </span></span>
<span><span class="co">##  [2] rngtools_1.5.2                         </span></span>
<span><span class="co">##  [3] foreach_1.5.2                          </span></span>
<span><span class="co">##  [4] tidyr_1.3.1                            </span></span>
<span><span class="co">##  [5] tidySummarizedExperiment_1.14.0        </span></span>
<span><span class="co">##  [6] ttservice_0.4.1                        </span></span>
<span><span class="co">##  [7] ggpubr_0.6.0                           </span></span>
<span><span class="co">##  [8] gridExtra_2.3                          </span></span>
<span><span class="co">##  [9] ggplot2_3.5.1                          </span></span>
<span><span class="co">## [10] purrr_1.0.2                            </span></span>
<span><span class="co">## [11] benchdamic_1.9.4                       </span></span>
<span><span class="co">## [12] dplyr_1.1.4                            </span></span>
<span><span class="co">## [13] phyloseq_1.48.0                        </span></span>
<span><span class="co">## [14] mia_1.12.0                             </span></span>
<span><span class="co">## [15] MultiAssayExperiment_1.30.3            </span></span>
<span><span class="co">## [16] MicrobiomeBenchmarkData_1.6.0          </span></span>
<span><span class="co">## [17] TreeSummarizedExperiment_2.12.0        </span></span>
<span><span class="co">## [18] Biostrings_2.72.1                      </span></span>
<span><span class="co">## [19] XVector_0.44.0                         </span></span>
<span><span class="co">## [20] SingleCellExperiment_1.26.0            </span></span>
<span><span class="co">## [21] SummarizedExperiment_1.34.0            </span></span>
<span><span class="co">## [22] Biobase_2.64.0                         </span></span>
<span><span class="co">## [23] GenomicRanges_1.56.1                   </span></span>
<span><span class="co">## [24] GenomeInfoDb_1.40.1                    </span></span>
<span><span class="co">## [25] IRanges_2.38.1                         </span></span>
<span><span class="co">## [26] S4Vectors_0.42.1                       </span></span>
<span><span class="co">## [27] BiocGenerics_0.50.0                    </span></span>
<span><span class="co">## [28] MatrixGenerics_1.16.0                  </span></span>
<span><span class="co">## [29] matrixStats_1.3.0                      </span></span>
<span><span class="co">## [30] MicrobiomeBenchmarkDataAnalyses_0.99.11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] igraph_2.0.3                ica_1.0-3                  </span></span>
<span><span class="co">##   [3] plotly_4.10.4               Formula_1.2-5              </span></span>
<span><span class="co">##   [5] scater_1.32.0               zlibbioc_1.50.0            </span></span>
<span><span class="co">##   [7] tidyselect_1.2.1            bit_4.0.5                  </span></span>
<span><span class="co">##   [9] doParallel_1.0.17           clue_0.3-65                </span></span>
<span><span class="co">##  [11] lattice_0.22-6              blob_1.2.4                 </span></span>
<span><span class="co">##  [13] stringr_1.5.1               S4Arrays_1.4.1             </span></span>
<span><span class="co">##  [15] tidytext_0.4.2              parallel_4.4.1             </span></span>
<span><span class="co">##  [17] png_0.1-8                   ZINQ_2.0                   </span></span>
<span><span class="co">##  [19] cli_3.6.3                   CVXR_1.0-14                </span></span>
<span><span class="co">##  [21] multtest_2.60.0             goftest_1.2-3              </span></span>
<span><span class="co">##  [23] pkgdown_2.1.0               textshaping_0.4.0          </span></span>
<span><span class="co">##  [25] bluster_1.14.0              tokenizers_0.3.0           </span></span>
<span><span class="co">##  [27] BiocNeighbors_1.22.0        uwot_0.2.2                 </span></span>
<span><span class="co">##  [29] curl_5.2.1                  zinbwave_1.26.0            </span></span>
<span><span class="co">##  [31] mime_0.12                   evaluate_0.24.0            </span></span>
<span><span class="co">##  [33] tidytree_0.4.6              leiden_0.4.3.1             </span></span>
<span><span class="co">##  [35] coin_1.4-3                  stringi_1.8.4              </span></span>
<span><span class="co">##  [37] corncob_0.4.1               backports_1.5.0            </span></span>
<span><span class="co">##  [39] fBasics_4032.96             desc_1.4.3                 </span></span>
<span><span class="co">##  [41] XML_3.99-0.17               lmerTest_3.1-3             </span></span>
<span><span class="co">##  [43] gsl_2.1-8                   Exact_3.2                  </span></span>
<span><span class="co">##  [45] httpuv_1.6.15               Wrench_1.22.0              </span></span>
<span><span class="co">##  [47] AnnotationDbi_1.66.0        magrittr_2.0.3             </span></span>
<span><span class="co">##  [49] splines_4.4.1               getopt_1.20.4              </span></span>
<span><span class="co">##  [51] logistf_1.26.0              jpeg_0.1-10                </span></span>
<span><span class="co">##  [53] pcaPP_2.0-4                 sctransform_0.4.1          </span></span>
<span><span class="co">##  [55] rootSolve_1.8.2.4           ggbeeswarm_0.7.2           </span></span>
<span><span class="co">##  [57] statip_0.2.3                DBI_1.2.3                  </span></span>
<span><span class="co">##  [59] genefilter_1.86.0           corpcor_1.6.10             </span></span>
<span><span class="co">##  [61] jquerylib_0.1.4             withr_3.0.0                </span></span>
<span><span class="co">##  [63] formula.tools_1.7.1         class_7.3-22               </span></span>
<span><span class="co">##  [65] systemfonts_1.1.0           lmtest_0.9-40              </span></span>
<span><span class="co">##  [67] operator.tools_1.6.3        mixOmics_6.28.0            </span></span>
<span><span class="co">##  [69] htmlwidgets_1.6.4           fs_1.6.4                   </span></span>
<span><span class="co">##  [71] directlabels_2024.1.21      ggrepel_0.9.5              </span></span>
<span><span class="co">##  [73] labeling_0.4.3              dearseq_1.16.0             </span></span>
<span><span class="co">##  [75] SparseArray_1.4.8           DESeq2_1.44.0              </span></span>
<span><span class="co">##  [77] cellranger_1.1.0            DEoptimR_1.1-3             </span></span>
<span><span class="co">##  [79] spatial_7.3-17              RcppZiggurat_0.1.6         </span></span>
<span><span class="co">##  [81] annotate_1.82.0             lmom_3.0                   </span></span>
<span><span class="co">##  [83] truncnorm_1.0-9             reticulate_1.38.0          </span></span>
<span><span class="co">##  [85] zoo_1.8-12                  knitr_1.48                 </span></span>
<span><span class="co">##  [87] UCSC.utils_1.0.0            modeest_2.4.0              </span></span>
<span><span class="co">##  [89] decontam_1.24.0             fansi_1.0.6                </span></span>
<span><span class="co">##  [91] caTools_1.18.2              patchwork_1.2.0            </span></span>
<span><span class="co">##  [93] grid_4.4.1                  data.table_1.15.4          </span></span>
<span><span class="co">##  [95] timeDate_4032.109           biglm_0.9-3                </span></span>
<span><span class="co">##  [97] rhdf5_2.48.0                pan_1.9                    </span></span>
<span><span class="co">##  [99] vegan_2.6-6.1               quantreg_5.98              </span></span>
<span><span class="co">## [101] RSpectra_0.16-1             irlba_2.3.5.1              </span></span>
<span><span class="co">## [103] janeaustenr_1.0.0           ellipsis_0.3.2             </span></span>
<span><span class="co">## [105] fastDummies_1.7.3           DescTools_0.99.54          </span></span>
<span><span class="co">## [107] lazyeval_0.2.2              yaml_2.3.9                 </span></span>
<span><span class="co">## [109] ade4_1.7-22                 survival_3.7-0             </span></span>
<span><span class="co">## [111] scattermore_1.2             crayon_1.5.3               </span></span>
<span><span class="co">## [113] RcppAnnoy_0.0.22            RColorBrewer_1.1-3         </span></span>
<span><span class="co">## [115] progressr_0.14.0            later_1.3.2                </span></span>
<span><span class="co">## [117] zCompositions_1.5.0-4       ggridges_0.5.6             </span></span>
<span><span class="co">## [119] codetools_0.2-20            base64enc_0.1-3            </span></span>
<span><span class="co">## [121] KEGGREST_1.44.1             Seurat_5.1.0               </span></span>
<span><span class="co">## [123] Rtsne_0.17                  shape_1.4.6.1              </span></span>
<span><span class="co">## [125] limma_3.60.3                filelock_1.0.3             </span></span>
<span><span class="co">## [127] foreign_0.8-86              pkgconfig_2.0.3            </span></span>
<span><span class="co">## [129] spatstat.univar_3.0-0       MicrobiomeStat_1.2         </span></span>
<span><span class="co">## [131] rmutil_1.1.10               spatstat.sparse_3.1-0      </span></span>
<span><span class="co">## [133] ape_5.8                     viridisLite_0.4.2          </span></span>
<span><span class="co">## [135] xtable_1.8-4                interp_1.1-6               </span></span>
<span><span class="co">## [137] highr_0.11                  car_3.1-2                  </span></span>
<span><span class="co">## [139] plyr_1.8.9                  httr_1.4.7                 </span></span>
<span><span class="co">## [141] rbibutils_2.2.16            tools_4.4.1                </span></span>
<span><span class="co">## [143] globals_0.16.3              SeuratObject_5.0.2         </span></span>
<span><span class="co">## [145] Rfast_2.1.0                 broom_1.0.6                </span></span>
<span><span class="co">## [147] beeswarm_0.4.0              htmlTable_2.4.2            </span></span>
<span><span class="co">## [149] checkmate_2.3.1             nlme_3.1-165               </span></span>
<span><span class="co">## [151] dbplyr_2.5.0                MatrixModels_0.5-3         </span></span>
<span><span class="co">## [153] lme4_1.1-35.5               digest_0.6.36              </span></span>
<span><span class="co">## [155] optparse_1.7.5              permute_0.9-7              </span></span>
<span><span class="co">## [157] numDeriv_2016.8-1.1         Matrix_1.7-0               </span></span>
<span><span class="co">## [159] farver_2.1.2                reshape2_1.4.4             </span></span>
<span><span class="co">## [161] SnowballC_0.7.1             yulab.utils_0.1.4          </span></span>
<span><span class="co">## [163] viridis_0.6.5               DirichletMultinomial_1.46.0</span></span>
<span><span class="co">## [165] rpart_4.1.23                mice_3.16.0                </span></span>
<span><span class="co">## [167] glue_1.7.0                  cachem_1.1.0               </span></span>
<span><span class="co">## [169] BiocFileCache_2.12.0        polyclip_1.10-6            </span></span>
<span><span class="co">## [171] Hmisc_5.1-3                 generics_0.1.3             </span></span>
<span><span class="co">## [173] CompQuadForm_1.4.3          mvtnorm_1.2-5              </span></span>
<span><span class="co">## [175] NADA_1.6-1.1                metagenomeSeq_1.46.0       </span></span>
<span><span class="co">## [177] survey_4.4-2                parallelly_1.37.1          </span></span>
<span><span class="co">## [179] statmod_1.5.0               biomformat_1.32.0          </span></span>
<span><span class="co">## [181] RcppHNSW_0.6.0              ragg_1.3.2                 </span></span>
<span><span class="co">## [183] ScaledMatrix_1.12.0         carData_3.0-5              </span></span>
<span><span class="co">## [185] minqa_1.2.7                 pbapply_1.7-2              </span></span>
<span><span class="co">## [187] ANCOMBC_2.6.0               timeSeries_4032.109        </span></span>
<span><span class="co">## [189] glmnet_4.1-8                spam_2.10-0                </span></span>
<span><span class="co">## [191] utf8_1.2.4                  ALDEx2_1.36.0              </span></span>
<span><span class="co">## [193] mitools_2.4                 gtools_3.9.5               </span></span>
<span><span class="co">## [195] readxl_1.4.3                softImpute_1.4-1           </span></span>
<span><span class="co">## [197] ggsignif_0.6.4              shiny_1.8.1.1              </span></span>
<span><span class="co">## [199] GenomeInfoDbData_1.2.12     energy_1.7-11              </span></span>
<span><span class="co">## [201] rhdf5filters_1.16.0         memoise_2.0.1              </span></span>
<span><span class="co">## [203] rmarkdown_2.27              scales_1.3.0               </span></span>
<span><span class="co">## [205] stabledist_0.7-1            gld_2.6.6                  </span></span>
<span><span class="co">## [207] future_1.33.2               RANN_2.6.1                 </span></span>
<span><span class="co">## [209] spatstat.data_3.1-2         rstudioapi_0.16.0          </span></span>
<span><span class="co">## [211] cluster_2.1.6               Maaslin2_1.18.0            </span></span>
<span><span class="co">## [213] hms_1.1.3                   GUniFrac_1.8               </span></span>
<span><span class="co">## [215] spatstat.utils_3.0-5        fitdistrplus_1.2-1         </span></span>
<span><span class="co">## [217] munsell_0.5.1               cowplot_1.1.3              </span></span>
<span><span class="co">## [219] ellipse_0.5.0               colorspace_2.1-0           </span></span>
<span><span class="co">## [221] jomo_2.7-6                  rlang_1.1.4                </span></span>
<span><span class="co">## [223] ggdendro_0.2.0              quadprog_1.5-8             </span></span>
<span><span class="co">## [225] DelayedMatrixStats_1.26.0   sparseMatrixStats_1.16.0   </span></span>
<span><span class="co">## [227] dotCall64_1.1-1             scuttle_1.14.0             </span></span>
<span><span class="co">## [229] mgcv_1.9-1                  xfun_0.45                  </span></span>
<span><span class="co">## [231] NOISeq_2.48.0               e1071_1.7-14               </span></span>
<span><span class="co">## [233] TH.data_1.1-2               rARPACK_0.11-0             </span></span>
<span><span class="co">## [235] iterators_1.0.14            modeltools_0.2-23          </span></span>
<span><span class="co">## [237] abind_1.4-5                 tibble_3.2.1               </span></span>
<span><span class="co">## [239] libcoin_1.0-10              treeio_1.28.0              </span></span>
<span><span class="co">## [241] gmp_0.7-4                   Rhdf5lib_1.26.0            </span></span>
<span><span class="co">## [243] DECIPHER_3.0.0              bitops_1.0-7               </span></span>
<span><span class="co">## [245] Rdpack_2.6                  promises_1.3.0             </span></span>
<span><span class="co">## [247] inline_0.3.19               RSQLite_2.3.7              </span></span>
<span><span class="co">## [249] sandwich_3.1-0              DelayedArray_0.30.1        </span></span>
<span><span class="co">## [251] proxy_0.4-27                Rmpfr_0.9-5                </span></span>
<span><span class="co">## [253] compiler_4.4.1              forcats_1.0.0              </span></span>
<span><span class="co">## [255] prettyunits_1.2.0           boot_1.3-30                </span></span>
<span><span class="co">## [257] beachmat_2.20.0             SparseM_1.84               </span></span>
<span><span class="co">## [259] microbiome_1.26.0           listenv_0.9.1              </span></span>
<span><span class="co">## [261] Rcpp_1.0.12                 edgeR_4.2.0                </span></span>
<span><span class="co">## [263] BiocSingular_1.20.0         tensor_1.5                 </span></span>
<span><span class="co">## [265] progress_1.2.3              MASS_7.3-61                </span></span>
<span><span class="co">## [267] BiocParallel_1.38.0         MAST_1.30.0                </span></span>
<span><span class="co">## [269] stable_1.1.6                spatstat.random_3.3-1      </span></span>
<span><span class="co">## [271] R6_2.5.1                    rstatix_0.7.2              </span></span>
<span><span class="co">## [273] fastmap_1.2.0               multcomp_1.4-25            </span></span>
<span><span class="co">## [275] vipor_0.4.7                 ROCR_1.0-11                </span></span>
<span><span class="co">## [277] mitml_0.4-5                 rsvd_1.0.5                 </span></span>
<span><span class="co">## [279] nnet_7.3-19                 gtable_0.3.5               </span></span>
<span><span class="co">## [281] KernSmooth_2.23-24          latticeExtra_0.6-30        </span></span>
<span><span class="co">## [283] miniUI_0.1.1.1              deldir_2.0-4               </span></span>
<span><span class="co">## [285] htmltools_0.5.8.1           RcppParallel_5.1.8         </span></span>
<span><span class="co">## [287] bit64_4.0.5                 spatstat.explore_3.3-1     </span></span>
<span><span class="co">## [289] lifecycle_1.0.4             MGLM_0.2.1                 </span></span>
<span><span class="co">## [291] nloptr_2.1.1                sass_0.4.9                 </span></span>
<span><span class="co">## [293] vctrs_0.6.5                 robustbase_0.99-3          </span></span>
<span><span class="co">## [295] spatstat.geom_3.3-2         sp_2.1-4                   </span></span>
<span><span class="co">## [297] future.apply_1.11.2         bslib_0.7.0                </span></span>
<span><span class="co">## [299] pillar_1.9.0                gplots_3.1.3.1             </span></span>
<span><span class="co">## [301] locfit_1.5-9.10             jsonlite_1.8.8             </span></span>
<span><span class="co">## [303] expm_0.999-9</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Samuel David Gamboa-Tuz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
